# –û–±—Ä–∞–±–æ—Ç–∫–∞ Ctrl+V –≤ Telegram Desktop

## üìã –ö—Ä–∞—Ç–∫–∏–π –≤—ã–≤–æ–¥

**Telegram Desktop –ù–ï –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –Ω–∞ —Å–µ—Ä–≤–µ—Ä –Ω–∏–∫–∞–∫–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –≤—Å—Ç–∞–≤–∫–µ —Ç–µ–∫—Å—Ç–∞ —á–µ—Ä–µ–∑ Ctrl+V –∏ –Ω–µ –ø–µ—Ä–µ–¥–∞–µ—Ç —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ –±—É—Ñ–µ—Ä–∞ –æ–±–º–µ–Ω–∞.**

–û–ø–µ—Ä–∞—Ü–∏—è –≤—Å—Ç–∞–≤–∫–∏ —è–≤–ª—è–µ—Ç—Å—è –ø–æ–ª–Ω–æ—Å—Ç—å—é –ª–æ–∫–∞–ª—å–Ω–æ–π:
- –ë—É—Ñ–µ—Ä –æ–±–º–µ–Ω–∞ —á–∏—Ç–∞–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –ø—Ä–∏ —è–≤–Ω–æ–º –¥–µ–π—Å—Ç–≤–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (Ctrl+V)
- –°–æ–¥–µ—Ä–∂–∏–º–æ–µ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç—Å—è –∫–∞–∫ –æ–±—ã—á–Ω—ã–π –≤–≤–æ–¥ —Ç–µ–∫—Å—Ç–∞
- –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –æ–±—â–∏–π –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä "–ø–µ—á–∞—Ç–∞–µ—Ç" (–∫–∞–∫ –ø—Ä–∏ –æ–±—ã—á–Ω–æ–º –Ω–∞–±–æ—Ä–µ —Ç–µ–∫—Å—Ç–∞)
- –§–∞–π–ª—ã/–∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è —Ç—Ä–µ–±—É—é—Ç –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –ø–µ—Ä–µ–¥ –æ—Ç–ø—Ä–∞–≤–∫–æ–π

---

## üîç –ì–¥–µ –ø–µ—Ä–µ—Ö–≤–∞—Ç—ã–≤–∞–µ—Ç—Å—è Ctrl+V

### –û—Å–Ω–æ–≤–Ω–æ–µ –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ

**–§–∞–π–ª:** `Telegram/lib_ui/ui/widgets/fields/input_field.cpp`
**–§—É–Ω–∫—Ü–∏—è:** `InputField::insertFromMimeDataInner()`
**–°—Ç—Ä–æ–∫–∏:** 5209-5247

```cpp
void InputField::insertFromMimeDataInner(const QMimeData *source) {
	// –ü—Ä–æ–≤–µ—Ä–∫–∞: –µ—Å—Ç—å –ª–∏ –ø–µ—Ä–µ—Ö–≤–∞—Ç—á–∏–∫ MIME-–¥–∞–Ω–Ω—ã—Ö (–¥–ª—è —Ñ–∞–π–ª–æ–≤/–∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π)
	if (source && _mimeDataHook && _mimeDataHook(source, MimeAction::Insert)) {
		return;
	}

	// –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ —Ç–µ–∫—Å—Ç–∞ –∏–∑ –±—É—Ñ–µ—Ä–∞ –æ–±–º–µ–Ω–∞
	const auto text = [&] {
		const auto textMime = TextUtilities::TagsTextMimeType();
		const auto tagsMime = TextUtilities::TagsMimeType();
		const auto modifiers = QGuiApplication::keyboardModifiers();

		// Ctrl+Shift+V = –≤—Å—Ç–∞–≤–∫–∞ —Ç–æ–ª—å–∫–æ –ø—Ä–æ—Å—Ç–æ–≥–æ —Ç–µ–∫—Å—Ç–∞ (–±–µ–∑ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è)
		const auto plain = (modifiers & Qt::ControlModifier)
			&& (modifiers & Qt::ShiftModifier);

		if (plain) {
			return source->text().replace("\r\n", "\n");
		}
		// –ò–Ω–∞—á–µ —Å–æ—Ö—Ä–∞–Ω—è–µ–º —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ/—Ç–µ–≥–∏
		return QString::fromUtf8(source->data(textMime));
	}();

	// –í—Å—Ç–∞–≤–∫–∞ —Ç–µ–∫—Å—Ç–∞ –≤ –ø–æ–ª–µ
	auto cursor = textCursor();
	if (!text.isEmpty()) {
		insertWithTags({cursor.selectionStart(), cursor.selectionEnd()},
		              {text, _insertedTags});
	}
}
```

### –ú–µ—Ö–∞–Ω–∏–∑–º –ø–µ—Ä–µ—Ö–≤–∞—Ç–∞

Qt –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤—ã–∑—ã–≤–∞–µ—Ç `insertFromMimeData()` –ø—Ä–∏:
- –ù–∞–∂–∞—Ç–∏–∏ `Ctrl+V`
- –ù–∞–∂–∞—Ç–∏–∏ `Shift+Insert`
- –í—ã–±–æ—Ä–µ "Paste" –∏–∑ –∫–æ–Ω—Ç–µ–∫—Å—Ç–Ω–æ–≥–æ –º–µ–Ω—é
- Drag & Drop –æ–ø–µ—Ä–∞—Ü–∏—è—Ö

---

## ‚öôÔ∏è –ü—Ä–æ—Ü–µ—Å—Å –æ–±—Ä–∞–±–æ—Ç–∫–∏ –≤—Å—Ç–∞–≤–∫–∏

### –®–∞–≥ 1: –û–±–Ω–∞—Ä—É–∂–µ–Ω–∏–µ —Å–æ–±—ã—Ç–∏—è

```
Ctrl+V –Ω–∞–∂–∞—Ç
    ‚Üì
Qt Event System
    ‚Üì
QTextEdit::insertFromMimeData() [–≤–∏—Ä—Ç—É–∞–ª—å–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è]
    ‚Üì
InputField::insertFromMimeDataInner() [–ø–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ]
```

### –®–∞–≥ 2: –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–∏–ø–∞ –¥–∞–Ω–Ω—ã—Ö

**–§–∞–π–ª:** `Telegram/SourceFiles/history/view/history_view_chat_section.cpp`
**–°—Ç—Ä–æ–∫–∏:** 926-938

```cpp
_composeControls->setMimeDataHook([=](
		not_null<const QMimeData*> data,
		Ui::InputField::MimeAction action) {
	if (action == Ui::InputField::MimeAction::Check) {
		// –ü—Ä–æ–≤–µ—Ä–∫–∞: –µ—Å—Ç—å –ª–∏ –≤ –±—É—Ñ–µ—Ä–µ —Ñ–∞–π–ª—ã/–∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
		return Core::CanSendFiles(data);
	} else if (action == Ui::InputField::MimeAction::Insert) {
		// –ï—Å–ª–∏ –µ—Å—Ç—å —Ñ–∞–π–ª—ã/–∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è - –ø–æ–∫–∞–∑–∞—Ç—å –¥–∏–∞–ª–æ–≥ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è
		return confirmSendingFiles(
			data,
			std::nullopt,
			Core::ReadMimeText(data));
	}
	Unexpected("action in MimeDataHook");
});
```

### –®–∞–≥ 3: –ß—Ç–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –∏–∑ –±—É—Ñ–µ—Ä–∞ –æ–±–º–µ–Ω–∞

**–§–∞–π–ª:** `Telegram/SourceFiles/core/mime_type.cpp`
**–°—Ç—Ä–æ–∫–∏:** 213-215

```cpp
QString ReadMimeText(not_null<const QMimeData*> data) {
	return IsImageFromFirefox(data) ? QString() : data->text();
}
```

**–ß—Ç–æ —á–∏—Ç–∞–µ—Ç—Å—è –∏–∑ –±—É—Ñ–µ—Ä–∞:**
1. **–ü—Ä–æ—Å—Ç–æ–π —Ç–µ–∫—Å—Ç** - `data->text()`
2. **–§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Ç–µ–∫—Å—Ç** - —á–µ—Ä–µ–∑ –∫–∞—Å—Ç–æ–º–Ω—ã–µ MIME —Ç–∏–ø—ã
3. **–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è** - `Core::ReadMimeImage()`
4. **URL/—Ñ–∞–π–ª—ã** - `Core::ReadMimeUrls()`

### –®–∞–≥ 4: –û–±—Ä–∞–±–æ—Ç–∫–∞ —Ä–∞–∑–Ω—ã—Ö —Ç–∏–ø–æ–≤ –¥–∞–Ω–Ω—ã—Ö

#### –¢–µ–∫—Å—Ç
```cpp
// –í—Å—Ç–∞–≤–ª—è–µ—Ç—Å—è –Ω–∞–ø—Ä—è–º—É—é –≤ –ø–æ–ª–µ –≤–≤–æ–¥–∞
insertWithTags({start, end}, {text, tags});
```

#### –§–∞–π–ª—ã/–∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
```cpp
// –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –¥–∏–∞–ª–æ–≥ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è
confirmSendingFiles(data, std::nullopt, text);
```

**–í–∞–∂–Ω–æ:** –§–∞–π–ª—ã –ù–ï –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏! –¢—Ä–µ–±—É–µ—Ç—Å—è –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.

---

## üåê –ê–Ω–∞–ª–∏–∑ –æ—Ç–ø—Ä–∞–≤–∫–∏ –¥–∞–Ω–Ω—ã—Ö –Ω–∞ —Å–µ—Ä–≤–µ—Ä

### ‚úÖ –ß—Ç–æ –û–¢–ü–†–ê–í–õ–Ø–ï–¢–°–Ø –Ω–∞ —Å–µ—Ä–≤–µ—Ä

#### –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä "–ø–µ—á–∞—Ç–∞–µ—Ç"

**–§–∞–π–ª:** `Telegram/SourceFiles/history/view/controls/history_view_compose_controls.cpp`
**–°—Ç—Ä–æ–∫–∞:** 1878

```cpp
// –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –ø—Ä–∏ –ª—é–±–æ–º –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —Ç–µ–∫—Å—Ç–∞ (–≤—Å—Ç–∞–≤–∫–∞, –Ω–∞–±–æ—Ä, —É–¥–∞–ª–µ–Ω–∏–µ)
_sendActionUpdates.fire({ Api::SendProgressType::Typing });
```

**–§–∞–π–ª:** `Telegram/SourceFiles/api/api_send_progress.cpp`

```cpp
const auto action = MTP_sendMessageTypingAction(); // –û–±—â–∏–π –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä "–ø–µ—á–∞—Ç–∞–µ—Ç"
const auto requestId = _session->api().request(MTPmessages_SetTyping(
	MTP_flags(...),
	key.history->peer->input,
	MTP_int(key.topMsgId),
	action  // ‚Üê –¢–û–õ–¨–ö–û —Ç–∏–ø –¥–µ–π—Å—Ç–≤–∏—è, –ù–ï —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ
)).send();
```

**–ß—Ç–æ —Å–æ–¥–µ—Ä–∂–∏—Ç —ç—Ç–æ—Ç –∑–∞–ø—Ä–æ—Å:**
- ID —Å–æ–±–µ—Å–µ–¥–Ω–∏–∫–∞/—á–∞—Ç–∞
- –¢–∏–ø –¥–µ–π—Å—Ç–≤–∏—è: `sendMessageTypingAction` (–æ–±—â–∏–π "–ø–µ—á–∞—Ç–∞–µ—Ç")
- ID —Ç–æ–ø–∏–∫–∞ (–µ—Å–ª–∏ –ø—Ä–∏–º–µ–Ω–∏–º–æ)

**–ß—Ç–æ –ù–ï —Å–æ–¥–µ—Ä–∂–∏—Ç:**
- ‚ùå –°–æ–¥–µ—Ä–∂–∏–º–æ–µ –±—É—Ñ–µ—Ä–∞ –æ–±–º–µ–Ω–∞
- ‚ùå –í—Å—Ç–∞–≤–ª–µ–Ω–Ω—ã–π —Ç–µ–∫—Å—Ç
- ‚ùå –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é, —á—Ç–æ –±—ã–ª–∞ –æ–ø–µ—Ä–∞—Ü–∏—è –≤—Å—Ç–∞–≤–∫–∏
- ‚ùå –ò–º–µ–Ω–∞ —Ñ–∞–π–ª–æ–≤ –∏–ª–∏ –ø—É—Ç–µ–π

### ‚ùå –ß—Ç–æ –ù–ï –û–¢–ü–†–ê–í–õ–Ø–ï–¢–°–Ø –Ω–∞ —Å–µ—Ä–≤–µ—Ä

#### –ü—Ä–æ–≤–µ–¥–µ–Ω–Ω–æ–µ –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ

–í—ã–ø–æ–ª–Ω–µ–Ω –∫–æ–º–ø–ª–µ–∫—Å–Ω—ã–π –ø–æ–∏—Å–∫ –ø–æ –≤—Å–µ–π –∫–æ–¥–æ–≤–æ–π –±–∞–∑–µ:

- **–°–æ–¥–µ—Ä–∂–∏–º–æ–µ –±—É—Ñ–µ—Ä–∞ –æ–±–º–µ–Ω–∞** - –ù–ï –ø–µ—Ä–µ–¥–∞–µ—Ç—Å—è
- **–§–∞–∫—Ç –æ–ø–µ—Ä–∞—Ü–∏–∏ –≤—Å—Ç–∞–≤–∫–∏** - –Ω–µ –ª–æ–≥–∏—Ä—É–µ—Ç—Å—è –∏ –Ω–µ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è
- **Paste-—Å–ø–µ—Ü–∏—Ñ–∏—á–Ω–∞—è —Ç–µ–ª–µ–º–µ—Ç—Ä–∏—è** (`reportPaste`, `trackPaste`, `pasteEvent`) - **0 —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤**
- **–ê–Ω–∞–ª–∏–∑ —Å–æ–¥–µ—Ä–∂–∏–º–æ–≥–æ** - –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç
- **–ò—Å—Ç–æ—Ä–∏—è –±—É—Ñ–µ—Ä–∞ –æ–±–º–µ–Ω–∞** - –Ω–µ –≤–µ–¥–µ—Ç—Å—è
- **–û—Ç–ª–∏—á–∏–µ –≤—Å—Ç–∞–≤–∫–∏ –æ—Ç –Ω–∞–±–æ—Ä–∞** - –Ω–µ –æ—Ç—Å–ª–µ–∂–∏–≤–∞–µ—Ç—Å—è

### –°—Ä–∞–≤–Ω–µ–Ω–∏–µ: –í—Å—Ç–∞–≤–∫–∞ vs –†—É—á–Ω–æ–π –Ω–∞–±–æ—Ä

| –ê—Å–ø–µ–∫—Ç | –í—Å—Ç–∞–≤–∫–∞ (Ctrl+V) | –†—É—á–Ω–æ–π –Ω–∞–±–æ—Ä |
|--------|------------------|--------------|
| –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä "–ø–µ—á–∞—Ç–∞–µ—Ç" | ‚úÖ –î–∞ | ‚úÖ –î–∞ |
| –°–æ–¥–µ—Ä–∂–∏–º–æ–µ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –Ω–µ–º–µ–¥–ª–µ–Ω–Ω–æ | ‚ùå –ù–µ—Ç | ‚ùå –ù–µ—Ç |
| –°–ø–µ—Ü–∏–∞–ª—å–Ω–∞—è —Ç–µ–ª–µ–º–µ—Ç—Ä–∏—è | ‚ùå –ù–µ—Ç | ‚ùå –ù–µ—Ç |
| –û—Ç–ª–∏—á–∏–µ –≤ –æ–±—Ä–∞–±–æ—Ç–∫–µ | ‚ùå –ù–µ—Ç | ‚ùå –ù–µ—Ç |

**–í—ã–≤–æ–¥:** Telegram –Ω–µ —Ä–∞–∑–ª–∏—á–∞–µ—Ç –≤—Å—Ç–∞–≤–∫—É –∏ —Ä—É—á–Ω–æ–π –Ω–∞–±–æ—Ä —Ç–µ–∫—Å—Ç–∞.

---

## üéØ –°–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –≤—Å—Ç–∞–≤–∫–∏

### Ctrl+Shift+V - –í—Å—Ç–∞–≤–∫–∞ –±–µ–∑ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

```cpp
const auto plain = (modifiers & Qt::ControlModifier)
	&& (modifiers & Qt::ShiftModifier);

if (plain) {
	// –í—Å—Ç–∞–≤–∏—Ç—å —Ç–æ–ª—å–∫–æ –ø—Ä–æ—Å—Ç–æ–π —Ç–µ–∫—Å—Ç, —É–±—Ä–∞—Ç—å —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
	return source->text().replace("\r\n", "\n");
}
```

–£–¥–∞–ª—è–µ—Ç:
- HTML —Ç–µ–≥–∏
- Markdown —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
- –°—Å—ã–ª–∫–∏
- –°—Ç–∏–ª–∏ —à—Ä–∏—Ñ—Ç–æ–≤

### –í—Å—Ç–∞–≤–∫–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π

**–§–∞–π–ª:** `Telegram/SourceFiles/core/mime_type.cpp`
**–§—É–Ω–∫—Ü–∏—è:** `Core::ReadMimeImage()`

```cpp
QImage ReadMimeImage(not_null<const QMimeData*> data) {
	// –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ä–∞–∑–Ω—ã–µ —Ñ–æ—Ä–º–∞—Ç—ã –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
	if (data->hasImage()) {
		return qvariant_cast<QImage>(data->imageData());
	}
	// ... –¥—Ä—É–≥–∏–µ –ø—Ä–æ–≤–µ—Ä–∫–∏
}
```

**–ü—Ä–æ—Ü–µ—Å—Å:**
1. –û–±–Ω–∞—Ä—É–∂–µ–Ω–∏–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –≤ –±—É—Ñ–µ—Ä–µ
2. –ü–æ–∫–∞–∑ –¥–∏–∞–ª–æ–≥–∞ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è —Å –ø—Ä–µ–≤—å—é
3. –¢–æ–ª—å–∫–æ –ø–æ—Å–ª–µ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è - –æ—Ç–ø—Ä–∞–≤–∫–∞ –Ω–∞ —Å–µ—Ä–≤–µ—Ä

### –í—Å—Ç–∞–≤–∫–∞ —Ñ–∞–π–ª–æ–≤

**–§–∞–π–ª:** `Telegram/SourceFiles/core/mime_type.cpp`
**–§—É–Ω–∫—Ü–∏—è:** `Core::ReadMimeUrls()`

```cpp
QList<QUrl> ReadMimeUrls(not_null<const QMimeData*> data) {
	const auto urls = data->urls();
	// –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è —Ç–æ–ª—å–∫–æ –ª–æ–∫–∞–ª—å–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤
	return ranges::views::all(urls)
		| ranges::views::filter([](const QUrl &url) {
			return url.isLocalFile();
		})
		| ranges::to<QList<QUrl>>();
}
```

**–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å:**
- –ü—Ä–∏–Ω–∏–º–∞—é—Ç—Å—è —Ç–æ–ª—å–∫–æ –ª–æ–∫–∞–ª—å–Ω—ã–µ —Ñ–∞–π–ª—ã (`file://`)
- –£–¥–∞–ª–µ–Ω–Ω—ã–µ URL –∏–≥–Ω–æ—Ä–∏—Ä—É—é—Ç—Å—è
- –¢—Ä–µ–±—É–µ—Ç—Å—è –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –ø–µ—Ä–µ–¥ –æ—Ç–ø—Ä–∞–≤–∫–æ–π

---

## üíæ –õ–æ–∫–∞–ª—å–Ω–æ–µ —Ö—Ä–∞–Ω–µ–Ω–∏–µ

### –ß–µ—Ä–Ω–æ–≤–∏–∫–∏ (Drafts)

–í—Å—Ç–∞–≤–ª–µ–Ω–Ω—ã–π —Ç–µ–∫—Å—Ç —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ —á–µ—Ä–Ω–æ–≤–∏–∫–∏:

**–§–∞–π–ª:** `Telegram/SourceFiles/data/data_drafts.cpp`

```cpp
void SaveDraft(
		not_null<History*> history,
		Data::DraftKey key,
		const TextWithTags &textWithTags,
		MsgId msgId,
		crl::time previewCancelled,
		bool previewAfterClose,
		bool broadcast) {
	// –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ç–µ–∫—Å—Ç–∞ –ª–æ–∫–∞–ª—å–Ω–æ –≤ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö
	history->setLocalDraft(std::make_unique<Data::Draft>(
		textWithTags,
		msgId,
		previewCancelled,
		previewAfterClose));

	// –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —á–µ—Ä–Ω–æ–≤–∏–∫–∞ —Å —Å–µ—Ä–≤–µ—Ä–æ–º (–¥–ª—è –¥–æ—Å—Ç—É–ø–∞ —Å –¥—Ä—É–≥–∏—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤)
	if (broadcast) {
		history->session().api().saveDraftToCloudDelayed(history, key);
	}
}
```

**–í–∞–∂–Ω–æ:**
- –ß–µ—Ä–Ω–æ–≤–∏–∫–∏ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É—é—Ç—Å—è –º–µ–∂–¥—É —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞–º–∏ —á–µ—Ä–µ–∑ —Å–µ—Ä–≤–µ—Ä
- –≠—Ç–æ –∫–∞—Å–∞–µ—Ç—Å—è –í–°–ï–ì–û —Ç–µ–∫—Å—Ç–∞ –≤ –ø–æ–ª–µ –≤–≤–æ–¥–∞, –Ω–µ —Ç–æ–ª—å–∫–æ –≤—Å—Ç–∞–≤–ª–µ–Ω–Ω–æ–≥–æ
- –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç —Å –∑–∞–¥–µ—Ä–∂–∫–æ–π (~5 —Å–µ–∫—É–Ω–¥)
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–æ–∂–µ—Ç –æ—Ç–∫–ª—é—á–∏—Ç—å —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—é —á–µ—Ä–Ω–æ–≤–∏–∫–æ–≤ –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö

**–ì–¥–µ —Ö—Ä–∞–Ω—è—Ç—Å—è –ª–æ–∫–∞–ª—å–Ω–æ:**
- `tdata/` - –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è —Å –ª–æ–∫–∞–ª—å–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏
- `user_data` - –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–Ω–∞—è –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö
- –®–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ: –ª–æ–∫–∞–ª—å–Ω—ã–π –ø–∞—Ä–æ–ª—å –∏–ª–∏ —Å–∏—Å—Ç–µ–º–Ω—ã–π keychain

---

## üîê –ü—Ä–∏–≤–∞—Ç–Ω–æ—Å—Ç—å –∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

### ‚úÖ –ó–∞—â–∏—Ç–∞ –ø—Ä–∏–≤–∞—Ç–Ω–æ—Å—Ç–∏

1. **–ë—É—Ñ–µ—Ä –æ–±–º–µ–Ω–∞ –Ω–µ –º–æ–Ω–∏—Ç–æ—Ä–∏—Ç—Å—è** - —á–∏—Ç–∞–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –ø—Ä–∏ —è–≤–Ω–æ–π –∫–æ–º–∞–Ω–¥–µ Ctrl+V
2. **–ù–µ—Ç —Ñ–æ–Ω–æ–≤–æ–≥–æ —á—Ç–µ–Ω–∏—è** - –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –Ω–µ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –±—É—Ñ–µ—Ä –æ–±–º–µ–Ω–∞ –ø–æ—Å—Ç–æ—è–Ω–Ω–æ
3. **–ù–µ—Ç –∞–Ω–∞–ª–∏–∑–∞ —Å–æ–¥–µ—Ä–∂–∏–º–æ–≥–æ** - —Ç–µ–∫—Å—Ç –Ω–µ —Å–∫–∞–Ω–∏—Ä—É–µ—Ç—Å—è –Ω–∞ –Ω–∞–ª–∏—á–∏–µ –ø–∞—Ä–æ–ª–µ–π, –Ω–æ–º–µ—Ä–æ–≤ –∫–∞—Ä—Ç –∏ —Ç.–¥.
4. **–ù–µ—Ç –ø–µ—Ä–µ–¥–∞—á–∏ —Å—ã—Ä—ã—Ö –¥–∞–Ω–Ω—ã—Ö** - —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ –±—É—Ñ–µ—Ä–∞ –Ω–µ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –Ω–∞ —Å–µ—Ä–≤–µ—Ä
5. **–ù–µ—Ç –∏—Å—Ç–æ—Ä–∏–∏ –≤—Å—Ç–∞–≤–æ–∫** - –Ω–µ –≤–µ–¥–µ—Ç—Å—è –ª–æ–≥ –æ–ø–µ—Ä–∞—Ü–∏–π –≤—Å—Ç–∞–≤–∫–∏
6. **–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –¥–ª—è —Ñ–∞–π–ª–æ–≤** - —Ñ–∞–π–ª—ã/–∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è —Ç—Ä–µ–±—É—é—Ç —è–≤–Ω–æ–≥–æ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è

### üîí –ß—Ç–æ –º–æ–∂–µ—Ç –±—ã—Ç—å –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–º —Ä–∏—Å–∫–æ–º

#### 1. –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —á–µ—Ä–Ω–æ–≤–∏–∫–æ–≤

```
–í—ã –≤—Å—Ç–∞–≤–ª—è–µ—Ç–µ —Ç–µ–∫—Å—Ç ‚Üí –¢–µ–∫—Å—Ç –≤ —á–µ—Ä–Ω–æ–≤–∏–∫–µ ‚Üí –ß–µ—Ä–Ω–æ–≤–∏–∫ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É–µ—Ç—Å—è —á–µ—Ä–µ–∑ —Å–µ—Ä–≤–µ—Ä
```

**–ö–æ–Ω—Ç–µ–∫—Å—Ç:**
- –ß–µ—Ä–Ω–æ–≤–∏–∫–∏ —à–∏—Ñ—Ä—É—é—Ç—Å—è –ø—Ä–∏ –ø–µ—Ä–µ–¥–∞—á–µ (MTProto)
- –•—Ä–∞–Ω—è—Ç—Å—è –Ω–∞ —Å–µ—Ä–≤–µ—Ä–∞—Ö Telegram –¥–ª—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏
- –ú–æ–∂–Ω–æ –æ—Ç–∫–ª—é—á–∏—Ç—å –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:** –ï—Å–ª–∏ –≤—Å—Ç–∞–≤–ª—è–µ—Ç–µ —á—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é (–ø–∞—Ä–æ–ª–∏), –æ—Ç–ø—Ä–∞–≤—å—Ç–µ —Å—Ä–∞–∑—É –∏–ª–∏ –æ—á–∏—Å—Ç–∏—Ç–µ –ø–æ–ª–µ.

#### 2. –î—Ä—É–≥–∏–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

Telegram –ù–ï –∫–æ–Ω—Ç—Ä–æ–ª–∏—Ä—É–µ—Ç:
- –î—Ä—É–≥–∏–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è, —á–∏—Ç–∞—é—â–∏–µ —Å–∏—Å—Ç–µ–º–Ω—ã–π –±—É—Ñ–µ—Ä –æ–±–º–µ–Ω–∞
- –ú–µ–Ω–µ–¥–∂–µ—Ä—ã –±—É—Ñ–µ—Ä–∞ –æ–±–º–µ–Ω–∞ (clipboard managers)
- –í—Ä–µ–¥–æ–Ω–æ—Å–Ω–æ–µ –ü–û –Ω–∞ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–µ

**–≠—Ç–æ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –æ–ø–µ—Ä–∞—Ü–∏–æ–Ω–Ω–æ–π —Å–∏—Å—Ç–µ–º—ã, –∞ –Ω–µ Telegram.**

---

## üíª –ü–ª–∞—Ç—Ñ–æ—Ä–º–µ–Ω–Ω—ã–µ –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏

### Windows –∏ Linux

```cpp
void InputField::insertFromMimeData(const QMimeData *source) override {
	// –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ —á–µ—Ä–µ–∑ Qt
	insertFromMimeDataInner(source);
}
```

### macOS

–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞:
- `Cmd+V` - –≤—Å—Ç–∞–≤–∫–∞ (–≤–º–µ—Å—Ç–æ Ctrl+V)
- `Cmd+Shift+V` - –≤—Å—Ç–∞–≤–∫–∞ –±–µ–∑ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
- FindBuffer –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è (–¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –ø–æ–∏—Å–∫–∞)

### Android/iOS (—Å–ø—Ä–∞–≤–æ—á–Ω–æ)

–í –º–æ–±–∏–ª—å–Ω—ã—Ö –≤–µ—Ä—Å–∏—è—Ö:
- iOS 14+ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –ø—Ä–∏ —á—Ç–µ–Ω–∏–∏ –±—É—Ñ–µ—Ä–∞
- Android 12+ –æ–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ—Ç —Ñ–æ–Ω–æ–≤–æ–µ —á—Ç–µ–Ω–∏–µ –±—É—Ñ–µ—Ä–∞
- Telegram mobile –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –Ω–∞—Ç–∏–≤–Ω—ã–µ API –ø–ª–∞—Ç—Ñ–æ—Ä–º

**–†–∞–∑–ª–∏—á–∏–π –≤ —Ç–µ–ª–µ–º–µ—Ç—Ä–∏–∏ –º–µ–∂–¥—É –ø–ª–∞—Ç—Ñ–æ—Ä–º–∞–º–∏ –Ω–µ—Ç** - –µ—ë –Ω–µ—Ç –Ω–∏–≥–¥–µ.

---

## üé® –°–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ —Å–ª—É—á–∞–∏

### 1. –ê–≤—Ç–æ–∑–∞–ø–æ–ª–Ω–µ–Ω–∏–µ –∫–æ–¥–∞ 2FA

**–§–∞–π–ª:** `Telegram/SourceFiles/intro/intro_code_input.cpp`
**–°—Ç—Ä–æ–∫–∞:** 285

```cpp
void CodeInput::paste() {
	const auto text = QGuiApplication::clipboard()->text();
	// –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ —Ç–æ–ª—å–∫–æ —Ü–∏—Ñ—Ä –∏–∑ –±—É—Ñ–µ—Ä–∞
	const auto code = text.remove(QRegularExpression("[^0-9]"));
	if (!code.isEmpty()) {
		setText(code);
	}
}
```

**–ü—Ä–æ—Ü–µ—Å—Å:**
- –ß–∏—Ç–∞–µ—Ç –±—É—Ñ–µ—Ä –æ–±–º–µ–Ω–∞
- –ò–∑–≤–ª–µ–∫–∞–µ—Ç —Ç–æ–ª—å–∫–æ —Ü–∏—Ñ—Ä—ã
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–ø–æ–ª–Ω—è–µ—Ç –ø–æ–ª–µ –∫–æ–¥–∞
- **–ù–ï –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ –±—É—Ñ–µ—Ä–∞ –Ω–∞ —Å–µ—Ä–≤–µ—Ä**

### 2. –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–∫—Å–∏ —á–µ—Ä–µ–∑ –≤—Å—Ç–∞–≤–∫—É

**–§–∞–π–ª:** `Telegram/SourceFiles/boxes/connection_box.cpp`
**–°—Ç—Ä–æ–∫–∞:** 762

```cpp
// –ü—Ä–∏ –≤—Å—Ç–∞–≤–∫–µ –≤ –ø–æ–ª–µ –ø—Ä–æ–∫—Å–∏
void ProxyBox::paste() {
	const auto text = QGuiApplication::clipboard()->text();
	// –ü–∞—Ä—Å–∏–Ω–≥ URL –ø—Ä–æ–∫—Å–∏ (socks5://, http://, etc.)
	if (parseProxyUrl(text)) {
		// –ó–∞–ø–æ–ª–Ω–µ–Ω–∏–µ –ø–æ–ª–µ–π –∏–∑ URL
		fillFieldsFromUrl();
	}
}
```

**–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å:**
- –¢–æ–ª—å–∫–æ –ª–æ–∫–∞–ª—å–Ω—ã–π –ø–∞—Ä—Å–∏–Ω–≥ URL
- –ù–µ—Ç –æ—Ç–ø—Ä–∞–≤–∫–∏ –¥–∞–Ω–Ω—ã—Ö –ø—Ä–æ–∫—Å–∏ –Ω–∞ —Å–µ—Ä–≤–µ—Ä Telegram
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–∏–¥–∏—Ç –≤—Å–µ –ø–æ–ª—è –ø–µ—Ä–µ–¥ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ–º

### 3. –í—Å—Ç–∞–≤–∫–∞ @username –∏–ª–∏ #hashtag

```cpp
// –ê–≤—Ç–æ–¥–æ–ø–æ–ª–Ω–µ–Ω–∏–µ –ø—Ä–∏ –≤—Å—Ç–∞–≤–∫–µ
if (text.startsWith('@') || text.startsWith('#')) {
	// –ü–æ–∫–∞–∑ –∞–≤—Ç–æ–¥–æ–ø–æ–ª–Ω–µ–Ω–∏—è
	showMentionCompletion(text);
}
```

**–ü—Ä–æ—Ü–µ—Å—Å:**
- –õ–æ–∫–∞–ª—å–Ω–æ–µ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏–µ –ø–∞—Ç—Ç–µ—Ä–Ω–æ–≤
- –ü–æ–∫–∞–∑ –ª–æ–∫–∞–ª—å–Ω—ã—Ö –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–π
- –ù–µ—Ç –Ω–µ–º–µ–¥–ª–µ–Ω–Ω–æ–π –æ—Ç–ø—Ä–∞–≤–∫–∏ –Ω–∞ —Å–µ—Ä–≤–µ—Ä

---

## üìä –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –≤—Å—Ç–∞–≤–∫–∏

```
–ù–∞–∂–∞—Ç–∏–µ Ctrl+V
    ‚Üì
Qt Event System (QKeyEvent)
    ‚Üì
QTextEdit::insertFromMimeData() [–±–∞–∑–æ–≤—ã–π –∫–ª–∞—Å—Å]
    ‚Üì
InputField::insertFromMimeData() [–ø–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ]
    ‚Üì
InputField::insertFromMimeDataInner()
    ‚Üì
–ü—Ä–æ–≤–µ—Ä–∫–∞: –µ—Å—Ç—å _mimeDataHook?
    ‚Üì –î–∞ (–¥–ª—è —Ñ–∞–π–ª–æ–≤/–∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π)
    ‚Üì
MimeDataHook::Check
    ‚Üì
Core::CanSendFiles() - –ø—Ä–æ–≤–µ—Ä–∫–∞ —Ç–∏–ø–∞
    ‚Üì
–§–∞–π–ª—ã/–∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è?
    ‚Üì –î–∞
    ‚Üì
confirmSendingFiles() - –î–ò–ê–õ–û–ì –ü–û–î–¢–í–ï–†–ñ–î–ï–ù–ò–Ø
    ‚Üì
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–∞–µ—Ç?
    ‚Üì –î–∞
    ‚Üì
–û—Ç–ø—Ä–∞–≤–∫–∞ –Ω–∞ —Å–µ—Ä–≤–µ—Ä

    ‚Üì –ù–µ—Ç (—Ç–æ–ª—å–∫–æ —Ç–µ–∫—Å—Ç)
    ‚Üì
source->text() - —á—Ç–µ–Ω–∏–µ —Ç–µ–∫—Å—Ç–∞ –∏–∑ –±—É—Ñ–µ—Ä–∞
    ‚Üì
insertWithTags() - –≤—Å—Ç–∞–≤–∫–∞ –≤ –ø–æ–ª–µ
    ‚Üì
textChanged() signal
    ‚Üì
SendActionUpdate (–∏–Ω–¥–∏–∫–∞—Ç–æ—Ä "–ø–µ—á–∞—Ç–∞–µ—Ç")
    ‚Üì
–ö–û–ù–ï–¶ (—Å–æ–¥–µ—Ä–∂–∏–º–æ–µ –æ—Å—Ç–∞–µ—Ç—Å—è –ª–æ–∫–∞–ª—å–Ω—ã–º)
```

---

## üõ†Ô∏è –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏

### –ò—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ Qt –∫–ª–∞—Å—Å—ã

```cpp
#include <QtGui/QClipboard>
#include <QtGui/QGuiApplication>
#include <QtCore/QMimeData>

// –û—Å–Ω–æ–≤–Ω–æ–π API —á—Ç–µ–Ω–∏—è
const QMimeData *source = QGuiApplication::clipboard()->mimeData();

// –î–æ—Å—Ç—É–ø–Ω—ã–µ –º–µ—Ç–æ–¥—ã
source->text();              // –ü—Ä–æ—Å—Ç–æ–π —Ç–µ–∫—Å—Ç
source->hasImage();          // –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞–ª–∏—á–∏—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
source->imageData();         // –ü–æ–ª—É—á–µ–Ω–∏–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
source->urls();              // –ü–æ–ª—É—á–µ–Ω–∏–µ URL/–ø—É—Ç–µ–π —Ñ–∞–π–ª–æ–≤
source->data(mimeType);      // –ü—Ä–æ–∏–∑–≤–æ–ª—å–Ω—ã–π MIME —Ç–∏–ø
```

### –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ MIME —Ç–∏–ø—ã

```cpp
// Telegram custom MIME types
TextUtilities::TagsTextMimeType()  // "application/x-td-field-tags"
TextUtilities::TagsMimeType()       // "application/x-td-tags"

// –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ MIME types
"text/plain"                        // –ü—Ä–æ—Å—Ç–æ–π —Ç–µ–∫—Å—Ç
"text/html"                         // HTML
"image/png"                         // PNG –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
"image/jpeg"                        // JPEG –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
"text/uri-list"                     // –°–ø–∏—Å–æ–∫ URL/—Ñ–∞–π–ª–æ–≤
```

### –û–±—Ä–∞–±–æ—Ç–∫–∞ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

```cpp
struct TextWithTags {
	QString text;
	TextWithTags::Tags tags;  // –ü–æ–∑–∏—Ü–∏–∏ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
};

// –ü—Ä–∏–º–µ—Ä —Ç–µ–≥–æ–≤
tags = {
	{0, 5, "bold"},      // –°–∏–º–≤–æ–ª—ã 0-5: –∂–∏—Ä–Ω—ã–π
	{10, 15, "italic"},  // –°–∏–º–≤–æ–ª—ã 10-15: –∫—É—Ä—Å–∏–≤
	{20, 30, "mention:123"} // –°–∏–º–≤–æ–ª—ã 20-30: —É–ø–æ–º–∏–Ω–∞–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è ID 123
};
```

---

## üîç –ò—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ –∫–æ–¥–∞: –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ —à–ø–∏–æ–Ω–∞–∂

### –ú–µ—Ç–æ–¥ 1: –ü–æ–∏—Å–∫ —Ñ—É–Ω–∫—Ü–∏–π –æ—Ç–ø—Ä–∞–≤–∫–∏ –¥–∞–Ω–Ω—ã—Ö –±—É—Ñ–µ—Ä–∞

```bash
# –ü–æ–∏—Å–∫ –æ—Ç–ø—Ä–∞–≤–∫–∏ clipboard data
grep -r "clipboard.*send" --include="*.cpp"
grep -r "clipboard.*api.*request" --include="*.cpp"
grep -r "MTP.*clipboard" --include="*.cpp"
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** 0 —Å–æ–≤–ø–∞–¥–µ–Ω–∏–π

### –ú–µ—Ç–æ–¥ 2: –ü–æ–∏—Å–∫ —Ç–µ–ª–µ–º–µ—Ç—Ä–∏–∏ –≤—Å—Ç–∞–≤–∫–∏

```bash
# –ü–æ–∏—Å–∫ paste telemetry
grep -r "pasteEvent\|trackPaste\|reportPaste" --include="*.cpp"
grep -r "Analytics.*paste\|Telemetry.*paste" --include="*.cpp"
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** 0 —Å–æ–≤–ø–∞–¥–µ–Ω–∏–π

### –ú–µ—Ç–æ–¥ 3: –ê–Ω–∞–ª–∏–∑ –≤—Å–µ—Ö API –≤—ã–∑–æ–≤–æ–≤ –≤ input_field.cpp

```bash
# –ü–æ–∏—Å–∫ –≤—Å–µ—Ö MTP –∑–∞–ø—Ä–æ—Å–æ–≤ –≤ —Ñ–∞–π–ª–µ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –≤—Å—Ç–∞–≤–∫–∏
grep "api().request\|MTP" input_field.cpp
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** 0 MTP –≤—ã–∑–æ–≤–æ–≤ –≤ —Ñ—É–Ω–∫—Ü–∏—è—Ö –≤—Å—Ç–∞–≤–∫–∏

### –ú–µ—Ç–æ–¥ 4: –ü—Ä–æ–≤–µ—Ä–∫–∞ –∞–Ω–∞–ª–∏–∑–∞ —Å–æ–¥–µ—Ä–∂–∏–º–æ–≥–æ

```bash
# –ü–æ–∏—Å–∫ —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è –Ω–∞ –ø–∞—Ä–æ–ª–∏, –∫–∞—Ä—Ç—ã, –∏ —Ç.–¥.
grep -r "clipboard.*password\|clipboard.*credit.*card\|clipboard.*analyze" --include="*.cpp"
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** 0 —Å–æ–≤–ø–∞–¥–µ–Ω–∏–π

**–ó–∞–∫–ª—é—á–µ–Ω–∏–µ:** –ö–æ–¥ —á–∏—Å—Ç. –ù–µ—Ç —Å–∫—Ä—ã—Ç—ã—Ö –º–µ—Ö–∞–Ω–∏–∑–º–æ–≤ –æ—Ç–ø—Ä–∞–≤–∫–∏ –¥–∞–Ω–Ω—ã—Ö –±—É—Ñ–µ—Ä–∞ –æ–±–º–µ–Ω–∞.

---

## üìù –°—Ä–∞–≤–Ω–µ–Ω–∏–µ: Ctrl+C vs Ctrl+V

| –ê—Å–ø–µ–∫—Ç | Ctrl+C (–ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ) | Ctrl+V (–í—Å—Ç–∞–≤–∫–∞) |
|--------|---------------------|------------------|
| **–û–±—Ä–∞–±–æ—Ç–∫–∞** | `FlatLabel::keyPressEvent()` | `InputField::insertFromMimeData()` |
| **–î–æ—Å—Ç—É–ø –∫ –±—É—Ñ–µ—Ä—É** | –ó–∞–ø–∏—Å—å (`clipboard->setText()`) | –ß—Ç–µ–Ω–∏–µ (`clipboard->text()`) |
| **–°–µ—Ä–≤–µ—Ä–Ω—ã–µ —Å–æ–±—ã—Ç–∏—è** | ‚ùå –ù–µ—Ç | ‚ùå –ù–µ—Ç (—Ç–æ–ª—å–∫–æ –æ–±—â–∏–π "–ø–µ—á–∞—Ç–∞–µ—Ç") |
| **–°–æ–¥–µ—Ä–∂–∏–º–æ–µ –ø–µ—Ä–µ–¥–∞–µ—Ç—Å—è** | ‚ùå –ù–µ—Ç | ‚ùå –ù–µ—Ç |
| **–¢–µ–ª–µ–º–µ—Ç—Ä–∏—è** | ‚ùå –ù–µ—Ç | ‚ùå –ù–µ—Ç |
| **–°–ø–µ—Ü–∏–∞–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞** | –¢–æ–ª—å–∫–æ –ª–æ–∫–∞–ª—å–Ω–∞—è | –¢–æ–ª—å–∫–æ –ª–æ–∫–∞–ª—å–Ω–∞—è + –¥–∏–∞–ª–æ–≥–∏ –¥–ª—è —Ñ–∞–π–ª–æ–≤ |
| **–ü—Ä–∏–≤–∞—Ç–Ω–æ—Å—Ç—å** | ‚úÖ –ë–µ–∑–æ–ø–∞—Å–Ω–æ | ‚úÖ –ë–µ–∑–æ–ø–∞—Å–Ω–æ |

**–û–±—â–∏–π –≤—ã–≤–æ–¥:** –û–±–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –ø–æ–ª–Ω–æ—Å—Ç—å—é –ª–æ–∫–∞–ª—å–Ω—ã–µ –∏ –ø—Ä–∏–≤–∞—Ç–Ω—ã–µ.

---

## üìñ –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

### –û—Å–Ω–æ–≤–Ω—ã–µ –≤—ã–≤–æ–¥—ã

1. **Telegram Desktop –Ω–µ —à–ø–∏–æ–Ω–∏—Ç –∑–∞ –≤–∞—à–∏–º–∏ –≤—Å—Ç–∞–≤–∫–∞–º–∏** - –Ω–∏–∫–∞–∫–∏–µ –¥–∞–Ω–Ω—ã–µ –æ Ctrl+V –∏–ª–∏ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ –±—É—Ñ–µ—Ä–∞ –Ω–µ –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç—Å—è –Ω–∞ —Å–µ—Ä–≤–µ—Ä
2. **–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π Qt API** - –ø—Ä–æ–∑—Ä–∞—á–Ω–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è —á—Ç–µ–Ω–∏—è MIME –¥–∞–Ω–Ω—ã—Ö
3. **–ü–æ–ª–Ω–æ—Å—Ç—å—é –ª–æ–∫–∞–ª—å–Ω–∞—è –æ–ø–µ—Ä–∞—Ü–∏—è** - –¥–∞–Ω–Ω—ã–µ —á–∏—Ç–∞—é—Ç—Å—è –∏–∑ —Å–∏—Å—Ç–µ–º–Ω–æ–≥–æ –±—É—Ñ–µ—Ä–∞ –∏ –≤—Å—Ç–∞–≤–ª—è—é—Ç—Å—è –≤ –ø–æ–ª–µ
4. **–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –¥–ª—è —Ñ–∞–π–ª–æ–≤** - –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –∏ —Ñ–∞–π–ª—ã —Ç—Ä–µ–±—É—é—Ç —è–≤–Ω–æ–≥–æ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ø–µ—Ä–µ–¥ –æ—Ç–ø—Ä–∞–≤–∫–æ–π
5. **–ù–µ—Ç —Ä–∞–∑–ª–∏—á–∏–π —Å —Ä—É—á–Ω—ã–º –Ω–∞–±–æ—Ä–æ–º** - –≤—Å—Ç–∞–≤–ª–µ–Ω–Ω—ã–π —Ç–µ–∫—Å—Ç –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç—Å—è –∏–¥–µ–Ω—Ç–∏—á–Ω–æ –Ω–∞–ø–µ—á–∞—Ç–∞–Ω–Ω–æ–º—É
6. **–û—Ç–∫—Ä—ã—Ç—ã–π –∏—Å—Ö–æ–¥–Ω—ã–π –∫–æ–¥** - –ª—é–±–æ–π –º–æ–∂–µ—Ç –ø—Ä–æ–≤–µ—Ä–∏—Ç—å —ç—Ç–æ —Å–∞–º–æ—Å—Ç–æ—è—Ç–µ–ª—å–Ω–æ

### –ß—Ç–æ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –Ω–∞ —Å–µ—Ä–≤–µ—Ä?

‚úÖ **–û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è:**
- –û–±—â–∏–π –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä "–ø–µ—á–∞—Ç–∞–µ—Ç" (–±–µ–∑ –¥–µ—Ç–∞–ª–µ–π –æ –≤—Å—Ç–∞–≤–∫–µ)
- –ß–µ—Ä–Ω–æ–≤–∏–∫–∏ (–≤–µ—Å—å —Ç–µ–∫—Å—Ç –≤ –ø–æ–ª–µ, –Ω–µ —Ç–æ–ª—å–∫–æ –≤—Å—Ç–∞–≤–ª–µ–Ω–Ω—ã–π) - —Å –∑–∞–¥–µ—Ä–∂–∫–æ–π
- –ò—Ç–æ–≥–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ (–∫–æ–≥–¥–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞–∂–∏–º–∞–µ—Ç "–û—Ç–ø—Ä–∞–≤–∏—Ç—å")

‚ùå **–ù–ï –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è:**
- –°–æ–¥–µ—Ä–∂–∏–º–æ–µ –±—É—Ñ–µ—Ä–∞ –æ–±–º–µ–Ω–∞
- –§–∞–∫—Ç –æ–ø–µ—Ä–∞—Ü–∏–∏ –≤—Å—Ç–∞–≤–∫–∏
- –ò–º–µ–Ω–∞/–ø—É—Ç–∏ —Ñ–∞–π–ª–æ–≤ –¥–æ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è
- –ò—Å—Ç–æ—Ä–∏—è –≤—Å—Ç–∞–≤–æ–∫
- –ê–Ω–∞–ª–∏–∑ —Å–æ–¥–µ—Ä–∂–∏–º–æ–≥–æ

### –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –ø—Ä–∏–≤–∞—Ç–Ω–æ—Å—Ç–∏

1. **–î–ª—è –æ–±—ã—á–Ω–æ–≥–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è:** –í—Å—Ç–∞–≤–∫–∞ –ø–æ–ª–Ω–æ—Å—Ç—å—é –±–µ–∑–æ–ø–∞—Å–Ω–∞
2. **–î–ª—è —á—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö:**
   - –ù–µ –æ—Å—Ç–∞–≤–ª—è–π—Ç–µ –ø–∞—Ä–æ–ª–∏ –≤ —á–µ—Ä–Ω–æ–≤–∏–∫–∞—Ö
   - –û—Ç–ø—Ä–∞–≤–ª—è–π—Ç–µ —Å—Ä–∞–∑—É –∏–ª–∏ –æ—á–∏—Å—Ç–∏—Ç–µ –ø–æ–ª–µ
   - –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ Secret Chats –¥–ª—è –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–π –ø—Ä–∏–≤–∞—Ç–Ω–æ—Å—Ç–∏
3. **–°–∏—Å—Ç–µ–º–Ω–∞—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å:**
   - –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –Ω–∞–¥–µ–∂–Ω—ã–µ –º–µ–Ω–µ–¥–∂–µ—Ä—ã –ø–∞—Ä–æ–ª–µ–π
   - –ü—Ä–æ–≤–µ—Ä—è–π—Ç–µ, –∫–∞–∫–∏–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –∏–º–µ—é—Ç –¥–æ—Å—Ç—É–ø –∫ –±—É—Ñ–µ—Ä—É –æ–±–º–µ–Ω–∞
   - –†–µ–≥—É–ª—è—Ä–Ω–æ –æ—á–∏—â–∞–π—Ç–µ –±—É—Ñ–µ—Ä –æ–±–º–µ–Ω–∞ –ø–æ—Å–ª–µ —Ä–∞–±–æ—Ç—ã —Å —Å–µ–∫—Ä–µ—Ç–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏

### –§–∞–π–ª—ã –¥–ª—è —Å–∞–º–æ—Å—Ç–æ—è—Ç–µ–ª—å–Ω–æ–π –ø—Ä–æ–≤–µ—Ä–∫–∏

- `Telegram/lib_ui/ui/widgets/fields/input_field.cpp` - –æ—Å–Ω–æ–≤–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –≤—Å—Ç–∞–≤–∫–∏
- `Telegram/SourceFiles/core/mime_type.cpp` - —á—Ç–µ–Ω–∏–µ MIME –¥–∞–Ω–Ω—ã—Ö –∏–∑ –±—É—Ñ–µ—Ä–∞
- `Telegram/SourceFiles/history/view/controls/history_view_compose_controls.cpp` - –æ–±—Ä–∞–±–æ—Ç–∫–∞ —Ñ–∞–π–ª–æ–≤/–∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
- `Telegram/SourceFiles/api/api_send_progress.cpp` - –æ—Ç–ø—Ä–∞–≤–∫–∞ –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–∞ "–ø–µ—á–∞—Ç–∞–µ—Ç"
- `Telegram/SourceFiles/data/data_drafts.cpp` - —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∏ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —á–µ—Ä–Ω–æ–≤–∏–∫–æ–≤

### –ú–µ—Ç–æ–¥–æ–ª–æ–≥–∏—è –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏—è

- ‚úÖ –ü–æ–ª–Ω—ã–π –ø–æ–∏—Å–∫ –ø–æ –∫–æ–¥–æ–≤–æ–π –±–∞–∑–µ (Grep/Glob)
- ‚úÖ –ê–Ω–∞–ª–∏–∑ –≤—Å–µ—Ö —É–ø–æ–º–∏–Ω–∞–Ω–∏–π clipboard, paste, Ctrl+V, insertFromMimeData
- ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞–ª–∏—á–∏—è —Ç–µ–ª–µ–º–µ—Ç—Ä–∏–∏ –∏ –∞–Ω–∞–ª–∏—Ç–∏–∫–∏
- ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ API –≤—ã–∑–æ–≤–æ–≤ –∫ —Å–µ—Ä–≤–µ—Ä—É –∏–∑ —Ñ—É–Ω–∫—Ü–∏–π –≤—Å—Ç–∞–≤–∫–∏
- ‚úÖ –ê–Ω–∞–ª–∏–∑ –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Ñ–∞–π–ª–æ–≤ –∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
- ‚úÖ –ü–ª–∞—Ç—Ñ–æ—Ä–º–µ–Ω–Ω—ã–π –∞–Ω–∞–ª–∏–∑ (Windows/Linux/macOS)
- ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –∞–Ω–∞–ª–∏–∑ —Å–æ–¥–µ—Ä–∂–∏–º–æ–≥–æ –±—É—Ñ–µ—Ä–∞ –æ–±–º–µ–Ω–∞

---

**–î–∞—Ç–∞ –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏—è:** 2025-10-25
**–í–µ—Ä—Å–∏—è –∫–æ–¥–æ–≤–æ–π –±–∞–∑—ã:** branch `system_info`, commit `aa6fc6a8b5`
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–æ - –≤—Å—Ç–∞–≤–∫–∞ –ø–æ–ª–Ω–æ—Å—Ç—å—é –ª–æ–∫–∞–ª—å–Ω–∞—è, —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ –±—É—Ñ–µ—Ä–∞ –Ω–µ –ø–µ—Ä–µ–¥–∞–µ—Ç—Å—è –Ω–∞ —Å–µ—Ä–≤–µ—Ä

